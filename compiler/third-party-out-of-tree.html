<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Third-party and Out-of-tree Crates Policy - Rust Forge</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Supplemental documentation for contributing to The Rust Programming Language">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Forge</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust-forge" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust-forge/edit/master/src/compiler/third-party-out-of-tree.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="third-party-and-out-of-tree-crates-policy"><a class="header" href="#third-party-and-out-of-tree-crates-policy">Third-party and Out-of-tree Crates Policy</a></h1>
<p>This policy describes the guidelines for creating out-of-tree crates for use in the compiler and
using third-party crates within the compiler.</p>
<h2 id="out-of-tree-crates"><a class="header" href="#out-of-tree-crates">Out-of-tree crates</a></h2>
<p>One of the primary goals of this policy is to ensure that there is consistency in how out-of-tree
crates used in the compiler are set up (at least, those maintained by the compiler team and living
in <code>rust-lang</code>) and that the experience is uniform across <code>rust-lang/rust</code> and these crates.</p>
<h3 id="when-should-parts-of-the-compiler-be-extracted-into-an-out-of-tree-crate"><a class="header" href="#when-should-parts-of-the-compiler-be-extracted-into-an-out-of-tree-crate">When should parts of the compiler be extracted into an out-of-tree crate?</a></h3>
<p>This is left to the discretion of compiler team members but should be discussed with the rest of
the team, either through raising the question at the weekly triage meeting or asynchronously using
<a href="./proposals-and-stabilizations.html">an approval decision</a>. If the crate is a product of a working
group, there should already be agreement within the working group that an out-of-tree crate is
suitable.</p>
<p>When considering creating an out-of-tree crate, it is worth balancing how general the crate should
be with the increased maintenance burden that this may bring if widely used.</p>
<h3 id="where-should-compiler-crates-live"><a class="header" href="#where-should-compiler-crates-live">Where should compiler crates live?</a></h3>
<p>Out-of-tree compiler crates should be hosted in the <code>rust-lang</code> organization - this simplifies
integration with external infrastructure tooling and will inherit existing team permissions on
GitHub. It should be made clear in any documentation that the compiler team and any appropriate
working groups are responsible for the crate. It is not recommended to start with a prototype in
another organization or personal repository.</p>
<h3 id="can-existing-out-of-tree-crates-from-personal-accounts-or-other-organizations-be-transferred"><a class="header" href="#can-existing-out-of-tree-crates-from-personal-accounts-or-other-organizations-be-transferred">Can existing out-of-tree crates from personal accounts or other organizations be transferred?</a></h3>
<p>Yes, this is encouraged. In order to do this, discuss this with the team and familiarize yourself
with <a href="https://help.github.com/en/articles/transferring-a-repository">the GitHub documentation for repository transfers</a> and then arrange to perform
the transfer. Once a transfer is complete, a redirect will exist in the original account or
organization and this will conflict with the names of any new forks of the transferred repository -
an email to GitHub is required to resolve this.</p>
<h3 id="who-owns-these-crates"><a class="header" href="#who-owns-these-crates">Who owns these crates?</a></h3>
<p>It is desired that a compiler team member or working group has loose ownership over a crate so
that there are clear owners who are responsible for making sure that new versions are published and
that pull requests are reviewed.</p>
<p>Sometimes a non-project member is the primary owner of a crate and the compiler team are added as
“fallback” maintainers in case the primary maintainer is no longer reachable. This is discouraged
but can be justified on a case-by-case basis.</p>
<h3 id="what-should-these-crates-be-named"><a class="header" href="#what-should-these-crates-be-named">What should these crates be named?</a></h3>
<p>Crate naming will be discussed when new out-of-tree crates are proposed to the compiler team.</p>
<p>Crate naming will differ on a case-by-case basis. Crates that are inherently tied to the
compiler would benefit from a name that is prefixed with <code>rustc_</code>. This is an indicator of how
stable the crate may be to prospective users. Other crates, which are more general-purpose, will
have names that are disentangled from the compiler.</p>
<h3 id="are-there-any-limitations-on-the-review-policy-for-out-of-tree-crates"><a class="header" href="#are-there-any-limitations-on-the-review-policy-for-out-of-tree-crates">Are there any limitations on the review policy for out-of-tree crates?</a></h3>
<p>Generally, the working groups and team members that are primarily free to maintain the crate using
whatever practices are best suited to their group, however, there are some limitations so that there
is some uniformity across the compiler and out-of-tree crates:</p>
<ul>
<li>Everyone with r+ on <code>rust-lang/rust</code> should be able to review and approve PRs.</li>
<li>Where possible, only active participants in the crate (or related working group) need be on the
review rotation for the crate.</li>
<li>It is fine to have additional reviewers on the crate who do not otherwise have r+ for Rust as a
whole, if those reviewers are actively involved in the working group or crate maintenance.</li>
<li>Major pull requests should have multiple reviewers.</li>
</ul>
<h3 id="what-is-required-of-an-out-of-tree-crate"><a class="header" href="#what-is-required-of-an-out-of-tree-crate">What is required of an out-of-tree crate?</a></h3>
<p>It is required that out-of-tree crates must:</p>
<ul>
<li>Be dual-licensed with Apache 2.0 and MIT when maintained by the compiler team (as the compiler
is) unless there is a compelling reason to do otherwise.
<ul>
<li>If another license is desired, this must be brought up when proposing the new crate for
compiler team members to agree. Prefer <a href="https://github.com/rust-lang/rust/blob/master/src/tools/tidy/src/deps.rs#L10-L19">licenses accepted by tidy</a>, unless otherwise
required (ports of code from other projects, etc).</li>
</ul>
</li>
<li>Abide by Rust’s code of conduct.</li>
<li>Specify that the crate is maintained by the Rust compiler team and any appropriate working groups.
<ul>
<li>In particular, this should detail the expected level of maintenance and stability for any
prospective users.</li>
<li>This should also link to the working group details in this repository.</li>
</ul>
</li>
<li>Be added to the list at the bottom of this page.</li>
<li>Follow semantic versioning.</li>
<li>Use GitHub merge queues and <code>@triagebot</code>.</li>
<li>Use labels that are compatible with the existing triage process. This will allow nominated issues
in your out-of-tree crate to be discussed during triage meetings.
<ul>
<li>eg. <code>T-compiler</code>, <code>I-compiler-nominated</code> (a full list is to be decided)</li>
</ul>
</li>
</ul>
<h3 id="is-there-a-requirement-for-community-infrastructure-for-an-out-of-tree-crate"><a class="header" href="#is-there-a-requirement-for-community-infrastructure-for-an-out-of-tree-crate">Is there a requirement for community infrastructure for an out-of-tree crate?</a></h3>
<p>There is no requirement that community infrastructure (such as Zulip servers/streams) be created for
out-of-tree crates. This may be desirable if an out-of-tree crate gains a large community of
contributors and users, but otherwise, the working group or compiler team streams should be used
initially.</p>
<p>Linkifiers for auto-linking to issues and PRs on the primary Rust Zulip server can be added on
request.</p>
<h3 id="are-there-any-recommendations-for-working-with-out-of-tree-crates"><a class="header" href="#are-there-any-recommendations-for-working-with-out-of-tree-crates">Are there any recommendations for working with out-of-tree crates?</a></h3>
<p>Recommendations for working with out-of-tree crates will be documented in the rustc-dev-guide (see
<a href="https://github.com/rust-lang/rustc-dev-guide/issues/285">rust-lang/rustc-dev-guide#285</a> for progress).</p>
<h3 id="how-should-stabilizationsemantic-changes-be-handled-in-out-of-tree-crates"><a class="header" href="#how-should-stabilizationsemantic-changes-be-handled-in-out-of-tree-crates">How should stabilization/semantic changes be handled in out-of-tree crates?</a></h3>
<p>It is important to involve the language team in any changes in out-of-tree crates that would result
in stabilization or semantic changes to the language. Submodule changes in PRs to <code>rust-lang/rust</code>
should be labelled appropriately (eg. <code>relnotes</code>, <code>t-compiler</code>, <code>t-lang</code>) just as if the change
were implemented in <code>rust-lang/rust</code> directly, include a description of the changes when it is not
obvious to those unfamiliar with the compiler or the out-of-tree crate.</p>
<hr />
<p>In summary, the process for establishing an out-of-tree crate is as follows:</p>
<ol>
<li>Where appropriate, discuss and confirm the need within the working group for the out-of-tree
crate.</li>
<li>Create a PR modifying this document to include the crate in the list below. Use
<a href="https://github.com/anp/rfcbot-rs#usage"><code>@rfcbot merge</code></a> to gain agreement from compiler
team members.</li>
<li>Create a new repository in the <code>rust-lang</code> organization using the teams repository.
<ol>
<li>
<p>Ensure that the <code>access.teams.compiler</code> key is set to <code>'maintain'</code> so that the team have
appropriate permissions.</p>
</li>
<li>
<p>Add a README describing the intended purpose of the crate, which team and working group are
responsible (link to their page in this repository) and the intended level of maintenance and
stability.</p>
<blockquote>
<p>This crate is developed and maintained by the <a href="https://github.com/rust-lang/compiler-team/tree/master/procedures">Rust compiler team</a> for use within
<code>rustc</code>, in particular, it is the responsibility of the
<a href="../../working-groups/template"><code>.template</code></a> working group. This crate [will have regular
breaking changes and provides no stability guarantees|is intended to remain stable and have
limited breaking changes].</p>
</blockquote>
</li>
<li>
<p>Include the <a href="https://github.com/rust-lang/rust/blob/master/LICENSE-APACHE">LICENSE-APACHE</a> and <a href="https://github.com/rust-lang/rust/blob/master/LICENSE-MIT">LICENSE-MIT</a> files from <code>rust-lang/rust</code>.</p>
</li>
<li>
<p>Include or link the <a href="../../about/code_of_conduct">CODE_OF_CONDUCT</a> file from <code>rust-lang/rust</code>.</p>
</li>
<li>
<p>Create a relevant <code>.gitignore</code> (<a href="https://gitignore.io/api/vim,rust,emacs,clion,visualstudio,visualstudiocode">here’s a sane default</a>).</p>
</li>
<li>
<p>Create <code>P-high</code>, <code>P-medium</code>, <code>P-low</code>, <code>I-compiler-nominated</code> and <code>T-compiler</code> labels.</p>
</li>
</ol>
</li>
<li>Perform any initial development required before integration with rustc.</li>
<li>Publish initial version, following semantic versioning.</li>
<li>Add the crate as a dependency to the appropriate in-tree crate and start using.</li>
</ol>
<h2 id="third-party-crates"><a class="header" href="#third-party-crates">Third-party crates</a></h2>
<p>It is sometimes desirable to use the functionality of an existing third-party crate in the compiler.</p>
<h3 id="when-can-a-third-party-crate-be-added-as-a-compiler-dependency"><a class="header" href="#when-can-a-third-party-crate-be-added-as-a-compiler-dependency">When can a third-party crate be added as a compiler dependency?</a></h3>
<p>It is desirable that a third-party crate being included in the compiler is well-maintained and that,
where possible, a compiler team member is added as a maintainer. You should consult with the
rest of the compiler team before making this decision.</p>
<h3 id="what-about-third-party-dependencies-to-out-of-tree-crates"><a class="header" href="#what-about-third-party-dependencies-to-out-of-tree-crates">What about third-party dependencies to out-of-tree crates?</a></h3>
<p>The same policies apply to all compiler-team-maintained crates used in the compiler.</p>
<h2 id="list-of-out-of-tree-crates"><a class="header" href="#list-of-out-of-tree-crates">List of out-of-tree crates</a></h2>
<p>This section contains the list of existing out-of-tree, compiler team-maintained crates:</p>
<ul>
<li><a href="https://github.com/rust-lang/chalk/"><code>rust-lang/chalk</code></a></li>
<li><a href="https://github.com/rust-lang/polonius/"><code>rust-lang/polonius</code></a></li>
<li><a href="https://github.com/rust-lang/measureme/"><code>rust-lang/measureme</code></a></li>
<li><a href="https://github.com/rust-lang/thorin/"><code>rust-lang/thorin</code></a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../compiler/backports.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../compiler/prioritization.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../compiler/backports.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../compiler/prioritization.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/moment.min.js"></script>
        <script src="../js/index.js"></script>


    </div>
    </body>
</html>
